<?php 
/**
 * Mapper class of ProposalBudgetLineItem
 * 
 * @copyright 2007 Global Market Insite Inc
 * @author Sujith T
 * @version 1.0
 * @package App 
 * @subpackage Billing
 */  

class Hb_Mapper_Proposal_ProposalBudgetLineItem extends Hb_Mapper_Mapper
{
  /**
   * Domain object class name
   *
   * @var string 
   */ 
   protected static $__domain = 'Hb_App_Proposal_ProposalBudgetLineItem'; 

  /**
   * primary key of the table
   *
   * @var string 
   */
   protected $primary_key = 'proposal_budget_line_item_id';
   
  /**
   * table name
   *
   * @var string 
   */  
   protected $table = 'proposal_budget_line_item';
   
   /**
    * Find by id
    *
    * @param int id Budget line item definition id
    * @return Hb_App_Billing_BillingReportItem Returns domain object
    */ 
   protected function doFindById($id) 
   { 
	  if (Hb_App_ObjectMap::hasObject('Hb_App_Proposal_ProposalBudgetLineItem', $id)) {
			return Hb_App_ObjectMap::getObject('Hb_App_Proposal_ProposalBudgetLineItem', $id);	
		}
	  
	  $select = $this->GetBaseSelect();	
	  $select->where('pbli.proposal_budget_line_item_id = ?', $id);
	  
	  return $this->getRow($select);

   } 
   
   /**
    * Prepare basic select statement
    *
    * 
    * @return select returns select member of db connection object
    */ 
   protected function GetBaseSelect() 
   { 
      $db = Hb_Util_Db_Connection::GetInstance();
	  
	  $select = $db->select();
	  $select->from(array('pbli' => 'proposal_budget_line_item'), array('proposal_budget_line_item_id', 
	  'pricing_item_group_id', 'proposal_budget_line_item_description', 
	  'sort_order', 'value_type', 'precision', 'display_on_pdf'));
	  
	  return $select;
   }

   /**
    * Save
    *
    * 
    * @return select returns select member of db connection object
    */ 
   protected function doSave(Hb_App_Object $obj) 
   {
   	  $row = (is_null($obj->GetId())) ? $this->Insert($obj) : $this->Update($obj);
	 
	  $row->proposal_budget_line_item_description	= $obj->GetProposalBudgetLineItemDescription();
	  $row->pricing_item_group_id					= $obj->GetPricingItemGroupId();
	  $row->precision								= $obj->GetPrecision();
	  $row->display_on_pdf							= $obj->GetDisplayOnPdf();
	  $row->sort_order								= $obj->GetSortOrder();
	  $row->value_type								= $obj->GetValueType();
	
	  $row->Save();
		
	  $obj->SetProposalBudgetLineItemId($row->proposal_budget_line_item_id);
   }

   /**
    * Builds Hb_App_Object object from the provided row member of Hb_Util_Db_Table object
    *
    * @param row $row 
    * @return Hb_App_Object
    */ 
   protected function doBuildObject($row) 
   {
   	  return new Hb_App_Proposal_ProposalBudgetLineItem($row->proposal_budget_line_item_id,
   	  			$row->proposal_budget_line_item_description,
   	  			$row->pricing_item_group_id,
   	  			null,
   	  			$row->precision,
   	  			$row->display_on_pdf,
   	  			$row->sort_order,
   	  			$row->value_type
   	  			);
   }
}
?>