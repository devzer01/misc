<?php 
/**
 * Mapper class of AccountComment
 * 
 * @copyright 2007 Global Market Insite Inc
 * @author Administrator
 * @version 1.0
 * @package Mapper 
 * @subpackage Account
 */  
class Hb_Mapper_Account_AccountComment extends Hb_Mapper_Mapper  
{  
  /**
   * Domain object class name
   *
   * @var string 
   */ 
   protected static $__domain = 'Hb_App_Account_AccountComment'; 

  /**
   * primary key of the table
   *
   * @var string 
   */
   protected $primary_key = 'account_comment_id';
   
  /**
   * table name
   *
   * @var string 
   */  
   protected $table = 'account_comment'; 
 
   /**
    * Find by id
    *
    * @param int id Account Comment Id
    * @return Hb_App_Account_AccountComment Returns domain object
    */ 
   protected function doFindById($id) 
   {
   	$select = $this->GetBaseSelect();	
	  	$select->where('ac.account_comment_id = ?', $id);
	  
	  return $this->getRow($select);
   }
     
   /**
    * Prepare basic select statement
    * 
    * @return select returns select member of db connection object
    */ 
   protected function GetBaseSelect() 
   { 
      $db = Hb_Util_Db_Connection::GetInstance();
	  
	  $select = $db->select();
	  $select->from(array('ac' => 'account_comment'), array(	'account_comment_id', 'account_id', 
	  																			'account_comment_type_id', 'comment_text', 'status', 'created_by'));
	  
	  return $select;
   } 
   
   /**
    * Builds the domain object from the provided row
    *
    * @param Object $row Table row
    * @return Hb_App_Account_AccountComment Returns domain object
    */ 
   function doBuildObject($row)
   { 
   	  return new Hb_App_Account_AccountComment($row->account_comment_id,
   	  			$row->account_comment_type_id,   	 			
   	  			$row->account_id,   	  			
   	  			$row->comment_text,
   	  			$row->status,
				$row->created_by
   	  		);
   } 
   
   /**
    * Save
    *
    * @param $obj object Instance of the Hb_App_Account_AccountComment
    */ 
   function doSave(Hb_App_Object $obj)
   { 
      $data = array(
      	'account_id'					=> $obj->GetAccountId(),
      	'account_comment_type_id'	=> $obj->GetAccountCommentTypeId(),
      	'comment_text'					=> $obj->GetCommentText(),
      	'status'                   => $obj->GetStatus());
    
      $db = Hb_Util_Db_Connection::GetInstance(); 
      
      if (is_null($obj->GetId())) {
      	$data['created_by'] = ($_SESSION["admin_id"] ? $_SESSION["admin_id"] : SYSTEM_USER);
	 		$data['created_date'] = date("Y-m-d h:i:s");
			$db->insert('account_comment', $data);
			$obj->SetAccountCommentId($db->lastInsertId());
	  } else {
	  	 	$data['modified_by'] = ($_SESSION["admin_id"] ? $_SESSION["admin_id"] : SYSTEM_USER);
         $data['modified_date'] = date("Y-m-d h:i:s");
			$db->update('account_comment', $data, 'account_comment_id = ' . $obj->GetId());
	  }
   } 
} 
?>